{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "target": {
          "limit": 100,
          "matchAny": false,
          "tags": [],
          "type": "dashboard"
        },
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": 3,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "panels": [],
      "title": "System Summary",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 12,
        "w": 18,
        "x": 0,
        "y": 1
      },
      "id": 2,
      "options": {
        "SVGBaseFix": true,
        "add100Percentage": true,
        "calcsMutation": "standard",
        "centerAlignContent": false,
        "codeData": "{\n  \"text\": \"Random text\"\n}",
        "css": "* { box-sizing: border-box; margin: 0; padding: 0; }\n.overview { width: 100%; height: 100%; padding: 12px; display: flex; flex-direction: column; gap: 8px; border-radius: 8px; font-family: Inter, sans-serif; }\n.overview.normal { border: 2px solid #37872d; }\n.overview.warning { border: 2px solid #e5ac0e; }\n.overview.critical { border: 2px solid #c4162a; }\n.status-bar { display: flex; justify-content: space-between; align-items: center; padding: 8px 14px; border-radius: 4px; color: white; font-weight: 700; font-size: 16px; }\n.status-bar.normal { background: #37872d; }\n.status-bar.warning { background: #e5ac0e; color: #000; }\n.status-bar.critical { background: #c4162a; }\n.sections { display: flex; gap: 8px; flex: 1; min-height: 0; }\n.section { flex: 1; background: rgba(0,0,0,0.04); border-radius: 6px; padding: 10px; overflow-y: auto; }\n.section.wide { flex: 2; }\n.section h4 { font-size: 13px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; opacity: 1; color: #777; border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 5px; }\n.cols { display: flex; gap: 16px; }\n.cols > div { flex: 1; }\n.mr { display: flex; justify-content: space-between; padding: 4px 0; font-size: 13px; color: #1a1a1a; }\n.mr .lb { opacity: 0.6; }\n.mr .vl { font-weight: 600; font-variant-numeric: tabular-nums; }\n.vl.normal { color: #1a1a1a; }\n.vl.warning { color: #b57a00; }\n.vl.critical { color: #c4162a; }\n.vl.na { color: #aaa; font-weight: 400; }\n.sub { font-size: 12px; color: #666; opacity: 1; margin-top: 8px; margin-bottom: 4px; font-weight: 600; }",
        "dynamicData": false,
        "dynamicFieldDisplayValues": false,
        "dynamicHtmlGraphics": false,
        "dynamicProps": false,
        "html": "<div class='overview normal' id='ov'>\n  <div class='status-bar normal' id='sb'><span>dg5R Server</span><span id='st'>Normal</span></div>\n  <div class='sections'>\n    <div class='section'>\n      <h4>Cooling Health</h4>\n      <div class='sub'>Loop 1</div>\n      <div class='mr'><span class='lb'>Inlet 1</span><span class='vl' id='v-inlet1'>-</span></div>\n      <div class='mr'><span class='lb'>Outlet 1</span><span class='vl' id='v-outlet1'>-</span></div>\n      <div class='sub'>Loop 2</div>\n      <div class='mr'><span class='lb'>Inlet 2</span><span class='vl' id='v-inlet2'>-</span></div>\n      <div class='mr'><span class='lb'>Outlet 2</span><span class='vl' id='v-outlet2'>-</span></div>\n      <div class='mr'><span class='lb'>Coolant Level</span><span class='vl' id='v-level'>-</span></div>\n      <div class='mr'><span class='lb'>Leakage</span><span class='vl' id='v-leak'>-</span></div>\n      <div class='mr'><span class='lb'>Chassis Temp</span><span class='vl' id='v-ctemp'>-</span></div>\n      <div class='mr'><span class='lb'>Chassis Humidity</span><span class='vl' id='v-chumid'>-</span></div>\n    </div>\n    <div class='section wide'>\n      <h4>Compute Health</h4>\n      <div class='cols'>\n        <div>\n          <div class='sub'>AI Processors (avg)</div>\n          <div class='mr'><span class='lb'>Temperature</span><span class='vl' id='v-gpu-temp'>-</span></div>\n          <div class='mr'><span class='lb'>Power</span><span class='vl' id='v-gpu-pwr'>-</span></div>\n          <div class='mr'><span class='lb'>Mem Util</span><span class='vl' id='v-gpu-mem'>-</span></div>\n          <div class='sub'>Memory</div>\n          <div class='mr'><span class='lb'>Available</span><span class='vl' id='v-mem-avail'>-</span></div>\n        </div>\n        <div>\n          <div class='sub'>CPUs (avg)</div>\n          <div class='mr'><span class='lb'>Temperature</span><span class='vl' id='v-cpu-temp'>-</span></div>\n          <div class='mr'><span class='lb'>Power</span><span class='vl' id='v-cpu-pwr'>-</span></div>\n          <div class='mr'><span class='lb'>CPU Util</span><span class='vl' id='v-cpu-util'>-</span></div>\n        </div>\n      </div>\n    </div>\n    <div class='section'>\n      <h4>Network Health</h4>\n      <div id='v-nics'>-</div>\n      <div class='mr' style='margin-top:8px'><span class='lb'>IB NIC Temp</span><span class='vl na' id='v-ib-temp'>-</span></div>\n    </div>\n  </div>\n</div>",
        "onInit": "",
        "onInitOnResize": false,
        "onRender": "const m={};\nconst nicMap={};\ndata.series.forEach(s=>{\n  if(!s.fields||s.fields.length<2)return;\n  const f=s.fields[1];\n  const labels=f.labels||{};\n  const component=labels.component||'';\n  const metric=labels.metric||'';\n  const extra=labels.extra||'';\n  const vals=f.values;\n  if(vals&&vals.length>0){\n    const val=vals[vals.length-1];\n    if(component==='network'&&metric==='link_status'){nicMap[extra]=val;}\n    else m[component+'_'+metric]=val;\n  }\n});\n\nfunction fmt(v,u,d){return v!==undefined&&v!==null?v.toFixed(d!==undefined?d:1)+u:'-';}\nfunction el(id){return htmlNode.querySelector('#'+id);}\nfunction setV(id,text,cls){\n  const e=el(id); if(!e)return;\n  e.textContent=text;\n  e.className='vl '+(cls||'normal');\n}\n\nfunction evalInlet(v){if(v===undefined)return'normal';if(v>45||v<18)return'critical';if(v>40||v<22)return'warning';return'normal';}\nfunction evalOutlet(v){if(v===undefined)return'normal';if(v>65)return'critical';if(v>60)return'warning';return'normal';}\nfunction evalChasT(v){if(v===undefined)return'normal';if(v>50)return'critical';if(v>40)return'warning';return'normal';}\nfunction evalChasH(v){if(v===undefined)return'normal';if(v>80||v<10)return'critical';if(v>60)return'warning';return'normal';}\nfunction evalGpuT(v){if(v===undefined)return'normal';if(v>90)return'critical';if(v>75)return'warning';return'normal';}\nfunction evalCpuT(v){if(v===undefined)return'normal';if(v>95)return'critical';if(v>85)return'warning';return'normal';}\nfunction evalIbTemp(v){if(v===undefined)return'normal';if(v>=115)return'critical';if(v>=105)return'warning';return'normal';}\nfunction evalMemAvail(total,avail){if(!total||!avail)return'normal';const p=avail/total*100;if(p<5)return'critical';if(p<20)return'warning';return'normal';}\n\nconst sts=[];\nconst i1=m['cooling_inlet1_temp'],i2=m['cooling_inlet2_temp'];\nconst o1=m['cooling_outlet1_temp'],o2=m['cooling_outlet2_temp'];\nconst lv=m['cooling_level_full'],lk=m['cooling_leak_detected'];\nconst ct=m['environment_air_temp'],ch=m['environment_air_humidity'];\n\nlet s;\ns=evalInlet(i1);sts.push(s);setV('v-inlet1',fmt(i1,'\\u00b0C'),s);\ns=evalInlet(i2);sts.push(s);setV('v-inlet2',fmt(i2,'\\u00b0C'),s);\ns=evalOutlet(o1);sts.push(s);setV('v-outlet1',fmt(o1,'\\u00b0C'),s);\ns=evalOutlet(o2);sts.push(s);setV('v-outlet2',fmt(o2,'\\u00b0C'),s);\ns=lv===0?'warning':'normal';sts.push(s);setV('v-level',lv===1?'HIGH':'MIDDLE',s);\ns=lk===1?'critical':'normal';sts.push(s);setV('v-leak',lk===1?'LEAKED':'NORMAL',s);\ns=evalChasT(ct);sts.push(s);setV('v-ctemp',fmt(ct,'\\u00b0C'),s);\ns=evalChasH(ch);sts.push(s);setV('v-chumid',fmt(ch,'%'),s);\n\nconst gpuTs=[],gpuPs=[],gpuMs=[],gpuCs=[];\nObject.keys(m).forEach(k=>{\n  if(k.match(/^gpu\\d+_temperature$/))gpuTs.push(m[k]);\n  if(k.match(/^gpu\\d+_power_current$/))gpuPs.push(m[k]);\n  if(k.match(/^gpu\\d+_memory_available$/))gpuMs.push(m[k]);\n});\nfunction avg(a){return a.length?a.reduce((s,v)=>s+v,0)/a.length:undefined;}\nconst gaT=avg(gpuTs),gaP=avg(gpuPs),gaM=avg(gpuMs),gaC=avg(gpuCs);\ns=evalGpuT(gaT);sts.push(s);setV('v-gpu-temp',fmt(gaT,'\\u00b0C'),s);\nsetV('v-gpu-pwr',fmt(gaP,'W'),'normal');\nsetV('v-gpu-mem',fmt(gaM,'%'),'normal');\n\nconst cpuTs=[],cpuPs=[];\nObject.keys(m).forEach(k=>{\n  if(k.match(/^cpu\\d+_temperature$/))cpuTs.push(m[k]);\n  if(k.match(/^cpu\\d+_power$/))cpuPs.push(m[k]);\n});\nconst caT=avg(cpuTs),caP=avg(cpuPs),cuU=m['cpu_usage_total'];\ns=evalCpuT(caT);sts.push(s);setV('v-cpu-temp',fmt(caT,'\\u00b0C'),s);\nsetV('v-cpu-pwr',fmt(caP,'W'),'normal');\nsetV('v-cpu-util',fmt(cuU,'%'),'normal');\n\nconst mT=m['memory_total'],mA=m['memory_available'];\ns=evalMemAvail(mT,mA);sts.push(s);setV('v-mem-avail',mT&&mA?((mA/mT*100).toFixed(1)+'%'):'-',s);\n\nconst ibT=m['ib_temperature'];\nconst ibEl=el('v-ib-temp');\nif(ibEl){\n  if(ibT===undefined||ibT===null){ibEl.className='vl na';ibEl.textContent='-';}\n  else{\n    const st=evalIbTemp(ibT);sts.push(st);\n    ibEl.className='vl '+st;\n    ibEl.textContent=ibT.toFixed(1)+'\\u00b0C';\n  }\n}\n\nconst nicsEl=el('v-nics');\nif(nicsEl){\n  const nics=Object.keys(nicMap).sort();\n  if(!nics.length){nicsEl.innerHTML='-';}\n  else{\n    let html='';\n    let anyDown=false;\n    nics.forEach(nic=>{\n      const v=nicMap[nic];\n      const st=v===1?'normal':'critical';\n      if(v!==1)anyDown=true;\n      html+='<div class=\"mr\"><span class=\"lb\">'+nic+'</span><span class=\"vl '+st+'\">'+(v===1?'UP':'DOWN')+'</span></div>';\n    });\n    nicsEl.innerHTML=html;\n    sts.push(anyDown?'critical':'normal');\n  }\n}\n\nlet worst='normal';\nsts.forEach(v=>{if(v==='critical')worst='critical';else if(v==='warning'&&worst!=='critical')worst='warning';});\nconst ov=el('ov');if(ov)ov.className='overview '+worst;\nconst sb=el('sb');if(sb)sb.className='status-bar '+worst;\nconst stEl=el('st');if(stEl)stEl.textContent=worst==='critical'?'Critical':worst==='warning'?'Warning':'Normal';",
        "overflow": "auto",
        "panelupdateOnMount": true,
        "reduceOptions": {
          "calcs": [
            "lastNotNull",
            "last",
            "firstNotNull",
            "first",
            "min",
            "max",
            "mean",
            "sum",
            "count",
            "range",
            "delta",
            "step",
            "diff",
            "logmin",
            "allIsZero",
            "allIsNull",
            "diffperc"
          ]
        },
        "renderOnMount": true,
        "rootCSS": "",
        "useGrafanaScrollbar": true
      },
      "pluginVersion": "2.2.1",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "editorMode": "code",
          "expr": "dlc_system_sensor{server=\"dg5R\"}",
          "instant": true,
          "legendFormat": "{{metric}}",
          "refId": "A"
        }
      ],
      "title": "Server Overview",
      "type": "gapit-htmlgraphics-panel"
    },
    {
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": {
        "h": 12,
        "w": 6,
        "x": 18,
        "y": 1
      },
      "id": 3,
      "options": {
        "alertInstanceLabelFilter": "",
        "alertName": "",
        "dashboardAlerts": false,
        "groupBy": [],
        "groupMode": "default",
        "maxItems": 20,
        "showInactiveAlerts": false,
        "sortOrder": 1,
        "stateFilter": {
          "error": true,
          "firing": true,
          "noData": false,
          "normal": false,
          "pending": true,
          "recovering": true
        },
        "viewMode": "list"
      },
      "pluginVersion": "12.1.0",
      "title": "Alert List",
      "type": "alertlist"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 13
      },
      "id": 4,
      "panels": [],
      "title": "Detailed",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 20,
        "w": 7,
        "x": 0,
        "y": 14
      },
      "id": 5,
      "options": {
        "SVGBaseFix": true,
        "add100Percentage": true,
        "calcsMutation": "standard",
        "centerAlignContent": false,
        "codeData": "{\n  \"text\": \"Random text\"\n}",
        "css": "* { box-sizing: border-box; margin: 0; padding: 0; }\n.cool { width: 100%; height: 100%; padding: 2px; font-family: Inter, sans-serif; color: #1a1a1a; display: flex; flex-direction: column; }\n.diagram { flex: 1; position: relative; min-height: 0; }\nsvg { width: 100%; height: 100%; }\n.sv { font-size: 8px; font-weight: 700; font-family: monospace; }\n.sv.normal { fill: #1a1a1a; }\n.sv.warning { fill: #b57a00; }\n.sv.critical { fill: #c4162a; }\n.cl { font-size: 8px; fill: #333; font-weight: 600; }\n.cl-sm { font-size: 6.5px; fill: rgba(0,0,0,0.45); font-weight: 400; }\n.cb { fill: rgba(0,0,0,0.05); stroke: rgba(0,0,0,0.2); stroke-width: 1; rx: 4; }\n.pipe-cold { stroke: #4A9BF5; stroke-width: 1.5; fill: none; marker-end: url(#arrowBlue); }\n.pipe-hot { stroke: #F2495C; stroke-width: 1.5; fill: none; marker-end: url(#arrowRed); }\n.sep { stroke: rgba(0,0,0,0.12); stroke-width: 1; }",
        "dynamicData": false,
        "dynamicFieldDisplayValues": false,
        "dynamicHtmlGraphics": false,
        "dynamicProps": false,
        "html": "<div class='cool'>\n<div class='diagram'>\n<svg viewBox='0 0 260 370' xmlns='http://www.w3.org/2000/svg'>\n  <defs>\n    <linearGradient id='gCold' x1='0' y1='0' x2='0' y2='1'>\n      <stop offset='0%' stop-color='rgba(74,155,245,0.25)'/>\n      <stop offset='100%' stop-color='rgba(74,155,245,0.08)'/>\n    </linearGradient>\n    <linearGradient id='gHot' x1='0' y1='0' x2='0' y2='1'>\n      <stop offset='0%' stop-color='rgba(242,73,92,0.22)'/>\n      <stop offset='100%' stop-color='rgba(242,73,92,0.07)'/>\n    </linearGradient>\n    <marker id='arrowBlue' markerWidth='3' markerHeight='3' refX='2.5' refY='1.5' orient='auto'><path d='M0,0 L3,1.5 L0,3 Z' fill='#4A9BF5'/></marker>\n    <marker id='arrowRed' markerWidth='3' markerHeight='3' refX='2.5' refY='1.5' orient='auto'><path d='M0,0 L3,1.5 L0,3 Z' fill='#F2495C'/></marker>\n  </defs>\n\n  <!-- Fan + Radiator -->\n  <rect class='cb' x='25' y='8' width='210' height='22'/>\n  <text class='cl' x='130' y='22' text-anchor='middle'>Fan + Radiator</text>\n\n\n  <path class='pipe-cold' d='M90,30 L90,44'/>\n  <path class='pipe-cold' d='M170,30 L170,44'/>\n\n  <!-- Reservoir + Coolant Level -->\n  <rect x='25' y='44' width='210' height='28' fill='url(#gCold)' stroke='rgba(74,155,245,0.55)' stroke-width='1' rx='4'/>\n  <text class='cl' x='130' y='57' text-anchor='middle'>Reservoir</text>\n  <text class='sv normal' id='sv-lev' x='130' y='68' text-anchor='middle'>Coolant Level: -</text>\n\n\n  <path class='pipe-cold' d='M90,72 L90,86'/>\n  <path class='pipe-cold' d='M170,72 L170,86'/>\n\n  <!-- Pumps -->\n  <rect class='cb' x='25' y='86' width='100' height='18'/>\n  <text class='cl' x='75' y='98' text-anchor='middle'>Pump</text>\n  <rect class='cb' x='135' y='86' width='100' height='18'/>\n  <text class='cl' x='185' y='98' text-anchor='middle'>Pump</text>\n\n  <path class='pipe-cold' d='M90,104 L90,118'/>\n  <path class='pipe-cold' d='M170,104 L170,118'/>\n\n  <!-- Coolant Inlet Manifold -->\n  <rect x='25' y='118' width='210' height='32' fill='url(#gCold)' stroke='rgba(74,155,245,0.55)' stroke-width='1' rx='4'/>\n  <text class='cl' x='130' y='130' text-anchor='middle'>Coolant Inlet Manifold</text>\n  <line x1='130' y1='132' x2='130' y2='148' stroke='rgba(0,0,0,0.18)' stroke-width='1' stroke-dasharray='3,2'/>\n  <text class='sv normal' id='sv-in1' x='78' y='145' text-anchor='middle'>Inlet 1: -</text>\n  <text class='sv normal' id='sv-in2' x='182' y='145' text-anchor='middle'>Inlet 2: -</text>\n\n  <path class='pipe-cold' d='M90,150 L90,164'/>\n  <path class='pipe-cold' d='M170,150 L170,164'/>\n\n  <!-- Heat Source -->\n  <rect x='25' y='164' width='210' height='28' fill='url(#gHot)' stroke='rgba(242,73,92,0.55)' stroke-width='1' rx='4'/>\n  <text class='cl' x='130' y='178' text-anchor='middle'>Heat Source</text>\n  <text class='cl-sm' x='130' y='188' text-anchor='middle'>(CPU / AI Processor / NIC)</text>\n\n  <path class='pipe-hot' d='M90,192 L90,206'/>\n  <path class='pipe-hot' d='M170,192 L170,206'/>\n\n  <!-- Coolant Outlet Manifold -->\n  <rect x='25' y='206' width='210' height='32' fill='url(#gHot)' stroke='rgba(242,73,92,0.55)' stroke-width='1' rx='4'/>\n  <text class='cl' x='130' y='218' text-anchor='middle'>Coolant Outlet Manifold</text>\n  <line x1='130' y1='220' x2='130' y2='236' stroke='rgba(0,0,0,0.18)' stroke-width='1' stroke-dasharray='3,2'/>\n  <text class='sv normal' id='sv-out1' x='78' y='233' text-anchor='middle'>Outlet 1: -</text>\n  <text class='sv normal' id='sv-out2' x='182' y='233' text-anchor='middle'>Outlet 2: -</text>\n\n  <!-- Return pipes -->\n  <path class='pipe-hot' d='M38,238 L38,252 L16,252 L16,19 L25,19'/>\n  <path class='pipe-hot' d='M222,238 L222,252 L244,252 L244,19 L235,19'/>\n\n  <!-- Separator -->\n  <line class='sep' x1='25' y1='260' x2='235' y2='260'/>\n\n  <!-- Status Section -->\n  <text class='cl' x='28' y='278'>Coolant ΔT1</text>\n  <text class='sv normal' id='sv-dt1' x='232' y='278' text-anchor='end'>-</text>\n\n  <text class='cl' x='28' y='296'>Coolant ΔT2</text>\n  <text class='sv normal' id='sv-dt2' x='232' y='296' text-anchor='end'>-</text>\n\n  <text class='cl' x='28' y='314'>Leak Detection</text>\n  <text class='sv normal' id='sv-leak' x='232' y='314' text-anchor='end'>-</text>\n\n  <text class='cl' x='28' y='332'>Chassis Temp</text>\n  <text class='sv normal' id='sv-ct' x='232' y='332' text-anchor='end'>-</text>\n\n  <text class='cl' x='28' y='350'>Chassis Humidity</text>\n  <text class='sv normal' id='sv-ch' x='232' y='350' text-anchor='end'>-</text>\n\n</svg>\n</div>\n</div>",
        "onInit": "",
        "onInitOnResize": false,
        "onRender": "const m={};\ndata.series.forEach(s=>{\n  if(!s.fields||s.fields.length<2)return;\n  const f=s.fields[1];\n  const metric=(f.labels||{}).metric||'';\n  const vals=f.values;\n  if(vals&&vals.length>0) m[metric]=vals[vals.length-1];\n});\n\nfunction fmt(v,d){return v!==undefined&&v!==null?v.toFixed(d!==undefined?d:1):'-';}\nfunction cls(st){return 'sv '+st;}\nfunction evalInlet(v){if(v===undefined)return'normal';if(v>45||v<18)return'critical';if(v>40||v<22)return'warning';return'normal';}\nfunction evalOutlet(v){if(v===undefined)return'normal';if(v>65)return'critical';if(v>60)return'warning';return'normal';}\nfunction evalDelta(v){if(v===undefined)return'normal';if(v>20)return'critical';if(v>15)return'warning';return'normal';}\nfunction evalChasT(v){if(v===undefined)return'normal';if(v>50)return'critical';if(v>40)return'warning';return'normal';}\nfunction evalChasH(v){if(v===undefined)return'normal';if(v>80||v<10)return'critical';if(v>60)return'warning';return'normal';}\n\nfunction setEl(id,text,status){\n  const e=htmlNode.querySelector('#'+id);if(!e)return;\n  e.textContent=text;\n  e.setAttribute('class',cls(status));\n}\n\nconst i1=m['inlet1_temp'],i2=m['inlet2_temp'];\nconst o1=m['outlet1_temp'],o2=m['outlet2_temp'];\nconst d1=m['delta_t1'],d2=m['delta_t2'];\nconst lv=m['level_full'],lk=m['leak_detected'];\nconst ct=m['air_temp'],ch=m['air_humidity'];\n\nsetEl('sv-in1','Inlet 1: '+fmt(i1)+'\\u00b0C',evalInlet(i1));\nsetEl('sv-in2','Inlet 2: '+fmt(i2)+'\\u00b0C',evalInlet(i2));\nsetEl('sv-out1','Outlet 1: '+fmt(o1)+'\\u00b0C',evalOutlet(o1));\nsetEl('sv-out2','Outlet 2: '+fmt(o2)+'\\u00b0C',evalOutlet(o2));\nsetEl('sv-dt1',fmt(d1)+'\\u00b0C',evalDelta(d1));\nsetEl('sv-dt2',fmt(d2)+'\\u00b0C',evalDelta(d2));\nsetEl('sv-leak',lk===1?'LEAKED':'NORMAL',lk===1?'critical':'normal');\nsetEl('sv-lev','Coolant Level: '+(lv===1?'HIGH':'MIDDLE'),lv===0?'warning':'normal');\nsetEl('sv-ct',fmt(ct)+'\\u00b0C',evalChasT(ct));\nsetEl('sv-ch',fmt(ch)+'%',evalChasH(ch));",
        "overflow": "hidden",
        "panelupdateOnMount": true,
        "reduceOptions": {
          "calcs": [
            "lastNotNull",
            "last",
            "firstNotNull",
            "first",
            "min",
            "max",
            "mean",
            "sum",
            "count",
            "range",
            "delta",
            "step",
            "diff",
            "logmin",
            "allIsZero",
            "allIsNull",
            "diffperc"
          ]
        },
        "renderOnMount": true,
        "rootCSS": "",
        "useGrafanaScrollbar": true
      },
      "pluginVersion": "2.2.1",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "editorMode": "code",
          "expr": "dlc_system_sensor{server=\"dg5R\", component=~\"cooling|environment\"}",
          "instant": true,
          "legendFormat": "{{metric}}",
          "refId": "A"
        }
      ],
      "title": "Cooling Health",
      "type": "gapit-htmlgraphics-panel"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 20,
        "w": 11,
        "x": 7,
        "y": 14
      },
      "id": 6,
      "options": {
        "SVGBaseFix": true,
        "add100Percentage": true,
        "calcsMutation": "standard",
        "centerAlignContent": false,
        "codeData": "{\n  \"text\": \"Random text\"\n}",
        "css": "* { box-sizing: border-box; margin: 0; padding: 0; }\n.compute { width: 100%; height: 100%; padding: 10px; font-family: Inter, sans-serif; color: #1a1a1a; display: flex; flex-direction: column; gap: 6px; }\n.toolbar { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; padding: 5px 0; border-bottom: 1px solid rgba(0,0,0,0.1); }\n.toolbar.sub { padding: 3px 0 3px 10px; border-bottom: 1px solid rgba(0,0,0,0.07); }\n.toolbar label { font-size: 12px; color: #333; display: flex; align-items: center; gap: 4px; cursor: pointer; }\n.toolbar.sub label { font-size: 11px; }\n.toolbar input[type=radio],\n.toolbar input[type=checkbox] { accent-color: #4A9BF5; cursor: pointer; width: 13px; height: 13px; }\n.tl { font-size: 11px; color: rgba(0,0,0,0.45); }\n.tb-sep { color: #aaa; margin: 0 4px; }\n.cards { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; padding-top: 6px; }\n.card { background: rgba(0,0,0,0.04); border-radius: 6px; padding: 10px; }\n.card h4 { font-size: 13px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; color: #555; opacity: 1; border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 5px; }\n.tbl { width: 100%; border-collapse: collapse; font-size: 13px; }\n.tbl th { text-align: left; font-weight: 600; padding: 4px 8px; color: #555; opacity: 1; font-size: 12px; border-bottom: 1px solid rgba(0,0,0,0.1); }\n.tbl td { padding: 4px 8px; font-variant-numeric: tabular-nums; color: #1a1a1a; }\n.tbl td.normal { color: #1a1a1a; }\n.tbl td.warning { color: #b57a00; }\n.tbl td.critical { color: #c4162a; }\n.bar-legend { display: flex; gap: 12px; margin-bottom: 6px; flex-wrap: wrap; }\n.bar-lg { display: flex; align-items: center; gap: 5px; font-size: 11px; color: rgba(0,0,0,0.65); }\n.bar-swatch { width: 10px; height: 10px; border-radius: 2px; display: inline-block; }\n.bar-group-label { font-size: 12px; color: rgba(0,0,0,0.55); margin: 8px 0 3px 0; font-weight: 600; }\n.bar-row { display: flex; align-items: center; margin: 3px 0; }\n.bar-label { width: 80px; font-size: 11px; color: rgba(0,0,0,0.6); flex-shrink: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n.bar-track { flex: 1; height: 16px; background: rgba(0,0,0,0.08); border-radius: 3px; position: relative; overflow: hidden; }\n.bar-fill { height: 100%; border-radius: 3px; position: absolute; left: 0; top: 0; }\n.bar-val { font-size: 11px; width: 65px; text-align: right; flex-shrink: 0; margin-left: 6px; font-variant-numeric: tabular-nums; }\n.bar-val.normal { color: #1a1a1a; }\n.bar-val.warning { color: #b57a00; }\n.bar-val.critical { color: #c4162a; }\n.util-line { margin-top: 8px; padding: 6px 8px; font-size: 13px; color: #1a1a1a; background: rgba(0,0,0,0.04); border-radius: 4px; }",
        "dynamicData": false,
        "dynamicFieldDisplayValues": false,
        "dynamicHtmlGraphics": false,
        "dynamicProps": false,
        "html": "<div class='compute'>\n  <div class='toolbar'>\n    <span class='tl'>View:</span>\n    <label><input type='radio' name='viewMode' value='table' checked/> Table</label>\n    <label><input type='radio' name='viewMode' value='bar'/> Bar</label>\n    <span class='tb-sep'>|</span>\n    <span class='tl'>Group:</span>\n    <label><input type='radio' name='groupBy' value='device' checked/> Device</label>\n    <label><input type='radio' name='groupBy' value='metric'/> Metric</label>\n    <span class='tb-sep'>|</span>\n    <span class='tl'>Show:</span>\n    <label><input type='checkbox' id='cb-gpu' checked/> AI Proc</label>\n    <label><input type='checkbox' id='cb-cpu' checked/> CPU</label>\n    <label><input type='checkbox' id='cb-mem' checked/> Mem</label>\n  </div>\n  <div class='toolbar sub' id='gpu-metrics'>\n    <span class='tl'>AI Proc:</span>\n    <label><input type='checkbox' id='gm-temp' checked/> Temp</label>\n    <label><input type='checkbox' id='gm-power' checked/> Power</label>\n    <label><input type='checkbox' id='gm-mem' checked/> Mem%</label>\n  </div>\n  <div class='toolbar sub' id='cpu-metrics'>\n    <span class='tl'>CPU:</span>\n    <label><input type='checkbox' id='cm-temp' checked/> Temp</label>\n    <label><input type='checkbox' id='cm-power' checked/> Power</label>\n    <label><input type='checkbox' id='cm-util' checked/> Util%</label>\n  </div>\n  <div class='toolbar sub' id='mem-metrics'>\n    <span class='tl'>Memory:</span>\n    <label><input type='checkbox' id='mm-avail' checked/> Avail%</label>\n  </div>\n  <div class='cards' id='content-area'>Loading...</div>\n</div>",
        "onInit": "htmlNode._doRender=function(data){\nvar m={};\ndata.series.forEach(function(s){if(!s.fields||s.fields.length<2)return;var f=s.fields[1];var labels=f.labels||{};var key=(labels.component||'')+'_'+(labels.metric||'');var vals=f.values;if(vals&&vals.length>0)m[key]=vals[vals.length-1];});\nfunction fmt(v,d){return v!==undefined&&v!==null?Number(v).toFixed(d!==undefined?d:1):'-';}\nfunction evalGpuT(v){if(v===undefined)return'normal';if(v>90)return'critical';if(v>75)return'warning';return'normal';}\nfunction evalCpuT(v){if(v===undefined)return'normal';if(v>95)return'critical';if(v>85)return'warning';return'normal';}\nfunction evalMemA(p){if(p===undefined)return'normal';if(p<5)return'critical';if(p<20)return'warning';return'normal';}\n\nvar isBar=(htmlNode.querySelector('input[name=viewMode]:checked')||{}).value==='bar';\nvar groupBy=(htmlNode.querySelector('input[name=groupBy]:checked')||{}).value||'device';\nvar showGpu=htmlNode.querySelector('#cb-gpu')?htmlNode.querySelector('#cb-gpu').checked:true;\nvar showCpu=htmlNode.querySelector('#cb-cpu')?htmlNode.querySelector('#cb-cpu').checked:true;\nvar showMem=htmlNode.querySelector('#cb-mem')?htmlNode.querySelector('#cb-mem').checked:true;\nfunction chk(id){var e=htmlNode.querySelector('#'+id);return e?e.checked:true;}\nvar gpuMbar=htmlNode.querySelector('#gpu-metrics');\nvar cpuMbar=htmlNode.querySelector('#cpu-metrics');\nvar memMbar=htmlNode.querySelector('#mem-metrics');\nif(gpuMbar)gpuMbar.style.display=showGpu?'':'none';\nif(cpuMbar)cpuMbar.style.display=showCpu?'':'none';\nif(memMbar)memMbar.style.display=showMem?'':'none';\nvar gpus={};\nObject.keys(m).forEach(function(k){var x;\nif(x=k.match(/^(gpu\\d+)_temperature$/)){gpus[x[1]]=gpus[x[1]]||{};gpus[x[1]].temp=m[k];}\nif(x=k.match(/^(gpu\\d+)_power_current$/)){gpus[x[1]]=gpus[x[1]]||{};gpus[x[1]].power=m[k];}\nif(x=k.match(/^(gpu\\d+)_power_limit$/)){gpus[x[1]]=gpus[x[1]]||{};gpus[x[1]].maxPwr=m[k];}\nif(x=k.match(/^(gpu\\d+)_memory_available$/)){gpus[x[1]]=gpus[x[1]]||{};gpus[x[1]].memU=m[k];}\n});\nvar cpuD={};\nObject.keys(m).forEach(function(k){var x;\nif(x=k.match(/^(cpu\\d+)_temperature$/)){cpuD[x[1]]=cpuD[x[1]]||{};cpuD[x[1]].temp=m[k];}\nif(x=k.match(/^(cpu\\d+)_power$/)){cpuD[x[1]]=cpuD[x[1]]||{};cpuD[x[1]].power=m[k];}\n});\nvar cpuU=m['cpu_usage_total'];\nObject.keys(cpuD).forEach(function(k){cpuD[k].util=cpuU;});\nvar mT=m['memory_total'],mA=m['memory_available'];var mU=mT&&mA?Math.round((mT-mA)*10)/10:undefined;\nvar maPct=mT&&mA?(mA/mT*100):undefined;\nvar bMax={gt:99,gp:770,gc:110,gm:110,ct:104.5,cp:330,cu:110,ma:110,mu:(mT||512)*1.1,ms:110};\nvar bClr={temp:'#4A9BF5',power:'#73BF69',coreU:'#FF9830',memU:'#B877D9',util:'#FFD664'};\nvar content=htmlNode.querySelector('#content-area');if(!content)return;\nvar h='';\nfunction barRow(lb,val,unit,max,color,ev){\nvar pct=(val!==undefined&&val!==null&&max)?Math.min(Math.abs(val)/max*100,100):0;\nvar cls=ev?ev(val):'normal';\nvar clr=cls==='critical'?'#F2495C':cls==='warning'?'#FADE2A':color;\nreturn '<div class=\"bar-row\"><span class=\"bar-label\">'+lb+'</span><div class=\"bar-track\"><div class=\"bar-fill\" style=\"width:'+pct+'%;background:'+clr+'\"></div></div><span class=\"bar-val '+cls+'\">'+fmt(val)+unit+'</span></div>';}\nif(!isBar){\nif(groupBy==='device'){\nif(showGpu){h+='<div class=\"card\"><h4>AI Processors</h4>';\nvar gc=[];\nif(chk('gm-temp'))gc.push({k:'temp',l:'Temp',u:'\\u00b0C',ev:evalGpuT});\nif(chk('gm-power'))gc.push({k:'power',l:'Power',u:'W',ev:null});\nif(chk('gm-mem'))gc.push({k:'memU',l:'Mem%',u:'%',ev:null});\nh+='<table class=\"tbl\"><tr><th>Device</th>';gc.forEach(function(c){h+='<th>'+c.l+'</th>';});h+='</tr>';\nvar gk=Object.keys(gpus).sort();\ngk.forEach(function(n){var g=gpus[n];h+='<tr><td>'+n+'</td>';\ngc.forEach(function(c){var v=g[c.k];var cl=c.ev?c.ev(v):'normal';h+='<td class=\"'+cl+'\">'+fmt(v)+c.u+'</td>';});h+='</tr>';});\nif(!gk.length)h+='<tr><td colspan=\"'+(gc.length+1)+'\" style=\"color:#666\">No data</td></tr>';\nh+='</table></div>';}\nif(showCpu){h+='<div class=\"card\"><h4>CPUs</h4>';\nvar cc=[];\nif(chk('cm-temp'))cc.push({k:'temp',l:'Temp',u:'\\u00b0C',ev:evalCpuT});\nif(chk('cm-power'))cc.push({k:'power',l:'Power',u:'W',ev:null});\nif(chk('cm-util'))cc.push({k:'util',l:'Util%',u:'%',ev:null});\nh+='<table class=\"tbl\"><tr><th>Device</th>';cc.forEach(function(c){h+='<th>'+c.l+'</th>';});h+='</tr>';\nvar ck=Object.keys(cpuD).sort();\nck.forEach(function(n){var c2=cpuD[n];h+='<tr><td>'+n+'</td>';\ncc.forEach(function(c){var v=c2[c.k];var cl=c.ev?c.ev(v):'normal';h+='<td class=\"'+cl+'\">'+fmt(v)+c.u+'</td>';});h+='</tr>';});\nif(!ck.length)h+='<tr><td colspan=\"'+(cc.length+1)+'\" style=\"color:#666\">No data</td></tr>';\nh+='</table></div>';}\nif(showMem){h+='<div class=\"card\"><h4>Memory</h4><table class=\"tbl\">';\nif(chk('mm-avail'))h+='<tr><td>Available</td><td class=\"'+evalMemA(maPct)+'\">'+fmt(maPct)+'%</td></tr>';\nh+='</table></div>';}\n}else{\nif(showGpu){h+='<div class=\"card\"><h4>AI Processors</h4>';\nvar gk=Object.keys(gpus).sort();\nh+='<table class=\"tbl\"><tr><th>Metric</th>';gk.forEach(function(n){h+='<th>'+n.replace(/.*_/,'#')+'</th>';});h+='</tr>';\nvar gm=[];\nif(chk('gm-temp'))gm.push({k:'temp',l:'Temp',u:'\\u00b0C',ev:evalGpuT});\nif(chk('gm-power'))gm.push({k:'power',l:'Power',u:'W',ev:null});\nif(chk('gm-mem'))gm.push({k:'memU',l:'Mem%',u:'%',ev:null});\ngm.forEach(function(r){h+='<tr><td>'+r.l+'</td>';\ngk.forEach(function(n){var v=gpus[n][r.k];var cl=r.ev?r.ev(v):'normal';h+='<td class=\"'+cl+'\">'+fmt(v)+r.u+'</td>';});h+='</tr>';});\nif(!gk.length)h+='<tr><td colspan=\"2\" style=\"color:#666\">No data</td></tr>';\nh+='</table></div>';}\nif(showCpu){h+='<div class=\"card\"><h4>CPUs</h4>';\nvar ck=Object.keys(cpuD).sort();\nh+='<table class=\"tbl\"><tr><th>Metric</th>';ck.forEach(function(n){h+='<th>'+n+'</th>';});h+='</tr>';\nvar cm=[];\nif(chk('cm-temp'))cm.push({k:'temp',l:'Temp',u:'\\u00b0C',ev:evalCpuT});\nif(chk('cm-power'))cm.push({k:'power',l:'Power',u:'W',ev:null});\nif(chk('cm-util'))cm.push({k:'util',l:'Util%',u:'%',ev:null});\ncm.forEach(function(r){h+='<tr><td>'+r.l+'</td>';\nck.forEach(function(n){var v=cpuD[n][r.k];var cl=r.ev?r.ev(v):'normal';h+='<td class=\"'+cl+'\">'+fmt(v)+r.u+'</td>';});h+='</tr>';});\nif(!ck.length)h+='<tr><td colspan=\"2\" style=\"color:#666\">No data</td></tr>';\nh+='</table></div>';}\nif(showMem){h+='<div class=\"card\"><h4>Memory</h4><table class=\"tbl\">';\nif(chk('mm-avail'))h+='<tr><td>Available</td><td class=\"'+evalMemA(maPct)+'\">'+fmt(maPct)+'%</td></tr>';\nh+='</table></div>';}\n}\n}else{\nif(groupBy==='device'){\nif(showGpu){h+='<div class=\"card\"><h4>AI Processors</h4>';\nvar gm=[];\nif(chk('gm-temp'))gm.push({k:'temp',l:'Temp',u:'\\u00b0C',mx:bMax.gt,c:bClr.temp,ev:evalGpuT});\nif(chk('gm-power'))gm.push({k:'power',l:'Power',u:'W',mx:bMax.gp,c:bClr.power,ev:null});\nif(chk('gm-mem'))gm.push({k:'memU',l:'Mem%',u:'%',mx:bMax.gm,c:bClr.memU,ev:null});\nh+='<div class=\"bar-legend\">';gm.forEach(function(x){h+='<span class=\"bar-lg\"><span class=\"bar-swatch\" style=\"background:'+x.c+'\"></span>'+x.l+'</span>';});h+='</div>';\nObject.keys(gpus).sort().forEach(function(n){var g=gpus[n];h+='<div class=\"bar-group-label\">'+n+'</div>';\ngm.forEach(function(x){h+=barRow(x.l,g[x.k],x.u,x.mx,x.c,x.ev);});});\nh+='</div>';}\nif(showCpu){h+='<div class=\"card\"><h4>CPUs</h4>';\nvar cm=[];\nif(chk('cm-temp'))cm.push({k:'temp',l:'Temp',u:'\\u00b0C',mx:bMax.ct,c:bClr.temp,ev:evalCpuT});\nif(chk('cm-power'))cm.push({k:'power',l:'Power',u:'W',mx:bMax.cp,c:bClr.power,ev:null});\nif(chk('cm-util'))cm.push({k:'util',l:'Util%',u:'%',mx:bMax.cu,c:bClr.util,ev:null});\nh+='<div class=\"bar-legend\">';cm.forEach(function(x){h+='<span class=\"bar-lg\"><span class=\"bar-swatch\" style=\"background:'+x.c+'\"></span>'+x.l+'</span>';});h+='</div>';\nObject.keys(cpuD).sort().forEach(function(n){var c2=cpuD[n];h+='<div class=\"bar-group-label\">'+n+'</div>';\ncm.forEach(function(x){h+=barRow(x.l,c2[x.k],x.u,x.mx,x.c,x.ev);});});\nh+='</div>';}\nif(showMem){h+='<div class=\"card\"><h4>Memory</h4>';\nif(chk('mm-avail'))h+=barRow('Available',maPct,'%',bMax.ma,bClr.temp,evalMemA);\nh+='</div>';}\n}else{\nif(showGpu){h+='<div class=\"card\"><h4>AI Processors</h4>';\nvar gm=[];\nif(chk('gm-temp'))gm.push({k:'temp',l:'Temperature',u:'\\u00b0C',mx:bMax.gt,c:bClr.temp,ev:evalGpuT});\nif(chk('gm-power'))gm.push({k:'power',l:'Power',u:'W',mx:bMax.gp,c:bClr.power,ev:null});\nif(chk('gm-mem'))gm.push({k:'memU',l:'Mem Util',u:'%',mx:bMax.gm,c:bClr.memU,ev:null});\nvar gk=Object.keys(gpus).sort();\ngm.forEach(function(x){h+='<div class=\"bar-group-label\">'+x.l+'</div>';\ngk.forEach(function(n){h+=barRow(n,gpus[n][x.k],x.u,x.mx,x.c,x.ev);});});\nh+='</div>';}\nif(showCpu){h+='<div class=\"card\"><h4>CPUs</h4>';\nvar cm=[];\nif(chk('cm-temp'))cm.push({k:'temp',l:'Temperature',u:'\\u00b0C',mx:bMax.ct,c:bClr.temp,ev:evalCpuT});\nif(chk('cm-power'))cm.push({k:'power',l:'Power',u:'W',mx:bMax.cp,c:bClr.power,ev:null});\nif(chk('cm-util'))cm.push({k:'util',l:'Utilization',u:'%',mx:bMax.cu,c:bClr.util,ev:null});\nvar ck=Object.keys(cpuD).sort();\ncm.forEach(function(x){h+='<div class=\"bar-group-label\">'+x.l+'</div>';\nck.forEach(function(n){h+=barRow(n,cpuD[n][x.k],x.u,x.mx,x.c,x.ev);});});\nh+='</div>';}\nif(showMem){h+='<div class=\"card\"><h4>Memory</h4>';\nif(chk('mm-avail')){h+='<div class=\"bar-group-label\">Available</div>';h+=barRow('Memory',maPct,'%',bMax.ma,bClr.temp,evalMemA);}\nh+='</div>';}\n}}\ncontent.innerHTML=h;\n};\nhtmlNode.querySelectorAll('input[type=radio],input[type=checkbox]').forEach(function(inp){\ninp.addEventListener('change',function(){if(htmlNode._lastData)htmlNode._doRender(htmlNode._lastData);});\n});",
        "onInitOnResize": false,
        "onRender": "htmlNode._lastData=data;\nif(htmlNode._doRender)htmlNode._doRender(data);",
        "overflow": "auto",
        "panelupdateOnMount": true,
        "reduceOptions": {
          "calcs": [
            "lastNotNull",
            "last",
            "firstNotNull",
            "first",
            "min",
            "max",
            "mean",
            "sum",
            "count",
            "range",
            "delta",
            "step",
            "diff",
            "logmin",
            "allIsZero",
            "allIsNull",
            "diffperc"
          ]
        },
        "renderOnMount": true,
        "rootCSS": "",
        "useGrafanaScrollbar": true
      },
      "pluginVersion": "2.2.1",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "editorMode": "code",
          "expr": "dlc_system_sensor{server=\"dg5R\", component=~\"cpu.*|gpu.*|memory\"}",
          "instant": true,
          "legendFormat": "{{metric}}",
          "refId": "A"
        }
      ],
      "title": "Compute Health",
      "type": "gapit-htmlgraphics-panel"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 20,
        "w": 6,
        "x": 18,
        "y": 14
      },
      "id": 7,
      "options": {
        "SVGBaseFix": true,
        "add100Percentage": true,
        "calcsMutation": "standard",
        "centerAlignContent": false,
        "codeData": "{\n  \"text\": \"Random text\"\n}",
        "css": "* { box-sizing: border-box; margin: 0; padding: 0; }\n.network { width: 100%; height: 100%; padding: 14px; font-family: Inter, sans-serif; color: #1a1a1a; display: flex; flex-direction: column; gap: 10px; }\n.net-card { background: rgba(0,0,0,0.04); border-radius: 6px; padding: 14px; }\n.net-card h4 { font-size: 14px; text-transform: uppercase; letter-spacing: 1px; color: #555; margin-bottom: 10px; border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 5px; }\n.nic-row { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; font-size: 13px; }\n.nic-name { opacity: 0.6; font-size: 12px; }\n.nic-badge { display: inline-flex; align-items: center; gap: 5px; font-weight: 700; }\n.dot { display: inline-block; width: 9px; height: 9px; border-radius: 50%; }\n.dot.up { background: #37872d; }\n.dot.down { background: #c4162a; }\n.badge-up { color: #37872d; }\n.badge-down { color: #c4162a; }\n.mr { display: flex; justify-content: space-between; padding: 5px 0; font-size: 14px; }\n.lb { opacity: 0.6; font-size: 13px; }\n.vl { font-weight: 700; font-variant-numeric: tabular-nums; }\n.vl.normal { color: #1a1a1a; }\n.vl.warning { color: #b57a00; }\n.vl.critical { color: #c4162a; }\n.vl.na { color: #aaa; font-weight: 400; }",
        "dynamicData": false,
        "dynamicFieldDisplayValues": false,
        "dynamicHtmlGraphics": false,
        "dynamicProps": false,
        "html": "<div class='network'>\n  <div class='net-card'>\n    <h4>NIC Link Status</h4>\n    <div id='nic-list'>-</div>\n  </div>\n  <div class='net-card'>\n    <h4>InfiniBand NIC Temp</h4>\n    <div class='mr'>\n      <span class='lb'>Chipset Temp</span>\n      <span class='vl na' id='ib-temp'>-</span>\n    </div>\n  </div>\n</div>",
        "onInit": "",
        "onInitOnResize": false,
        "onRender": "const nicMap={};\nlet ibTemp=undefined;\ndata.series.forEach(s=>{\n  if(!s.fields||s.fields.length<2)return;\n  const f=s.fields[1];\n  const labels=f.labels||{};\n  const component=labels.component||'';\n  const metric=labels.metric||'';\n  const extra=labels.extra||'';\n  const vals=f.values;\n  if(!vals||!vals.length)return;\n  const val=vals[vals.length-1];\n  if(component==='network'&&metric==='link_status'){nicMap[extra]=val;}\n  else if(component==='ib'&&metric==='temperature'){ibTemp=val;}\n});\n\n// NIC list\nconst listEl=htmlNode.querySelector('#nic-list');\nif(listEl){\n  const nics=Object.keys(nicMap).sort();\n  if(!nics.length){listEl.innerHTML='<span style=\"color:#aaa;font-size:13px\">No data</span>';}\n  else{\n    let html='';\n    nics.forEach(nic=>{\n      const up=nicMap[nic]===1;\n      html+='<div class=\"nic-row\">'\n           +'<span class=\"nic-name\">'+nic+'</span>'\n           +'<span class=\"nic-badge\"><span class=\"dot '+(up?'up':'down')+'\"></span>'\n           +'<span class=\"badge-'+(up?'up':'down')+'\">'+(up?'UP':'DOWN')+'</span></span>'\n           +'</div>';\n    });\n    listEl.innerHTML=html;\n  }\n}\n\n// IB temperature\nconst ibEl=htmlNode.querySelector('#ib-temp');\nif(ibEl){\n  if(ibTemp===undefined||ibTemp===null){\n    ibEl.className='vl na'; ibEl.textContent='N/A';\n  } else {\n    const cls=ibTemp>=115?'critical':ibTemp>=105?'warning':'normal';\n    ibEl.className='vl '+cls;\n    ibEl.textContent=ibTemp.toFixed(1)+'\\u00b0C';\n  }\n}",
        "overflow": "auto",
        "panelupdateOnMount": true,
        "reduceOptions": {
          "calcs": [
            "lastNotNull",
            "last",
            "firstNotNull",
            "first",
            "min",
            "max",
            "mean",
            "sum",
            "count",
            "range",
            "delta",
            "step",
            "diff",
            "logmin",
            "allIsZero",
            "allIsNull",
            "diffperc"
          ]
        },
        "renderOnMount": true,
        "rootCSS": "",
        "useGrafanaScrollbar": true
      },
      "pluginVersion": "2.2.1",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "editorMode": "code",
          "expr": "dlc_system_sensor{server=\"dg5R\", component=\"network\", metric=\"link_status\"}",
          "instant": true,
          "legendFormat": "{{extra}}",
          "refId": "A"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "editorMode": "code",
          "expr": "dlc_system_sensor{server=\"dg5R\", component=\"ib\", metric=\"temperature\"}",
          "instant": true,
          "legendFormat": "IB temp",
          "refId": "B"
        }
      ],
      "title": "Network Health",
      "type": "gapit-htmlgraphics-panel"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 34
      },
      "id": 8,
      "panels": [],
      "title": "History",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "dashed"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "#EAB839",
                "value": 40
              },
              {
                "color": "red",
                "value": 45
              }
            ]
          },
          "unit": "celsius"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byRegexp",
              "options": "/outlet/"
            },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "green",
                      "value": 0
                    },
                    {
                      "color": "#EAB839",
                      "value": 60
                    },
                    {
                      "color": "red",
                      "value": 65
                    }
                  ]
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byRegexp",
              "options": "/deltaT/"
            },
            "properties": [
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "green",
                      "value": 0
                    },
                    {
                      "color": "#EAB839",
                      "value": 15
                    },
                    {
                      "color": "red",
                      "value": 20
                    }
                  ]
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 14,
        "w": 12,
        "x": 0,
        "y": 35
      },
      "id": 9,
      "options": {
        "legend": {
          "calcs": [
            "min",
            "max",
            "mean"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.1.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "editorMode": "code",
          "expr": "dlc_system_sensor{server=\"dg5R\", component=\"cooling\", metric=~\"inlet[0-9]_temp|outlet[0-9]_temp|delta_t[0-9]\"}",
          "legendFormat": "{{metric}}",
          "range": true,
          "refId": "A"
        }
      ],
      "title": "Coolant Temperature",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "dashed"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "#EAB839",
                "value": 40
              },
              {
                "color": "red",
                "value": 50
              }
            ]
          },
          "unit": "celsius"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Air humidity"
            },
            "properties": [
              {
                "id": "custom.axisPlacement",
                "value": "right"
              },
              {
                "id": "unit",
                "value": "percent"
              },
              {
                "id": "thresholds",
                "value": {
                  "mode": "absolute",
                  "steps": [
                    {
                      "color": "red",
                      "value": 0
                    },
                    {
                      "color": "#EAB839",
                      "value": 10
                    },
                    {
                      "color": "green",
                      "value": 20
                    },
                    {
                      "color": "#EAB839",
                      "value": 60
                    },
                    {
                      "color": "red",
                      "value": 80
                    }
                  ]
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 35
      },
      "id": 10,
      "options": {
        "legend": {
          "calcs": [
            "min",
            "max",
            "mean"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.1.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "editorMode": "code",
          "expr": "dlc_system_sensor{server=\"dg5R\", component=\"environment\", metric=\"air_temp\"}",
          "legendFormat": "{{metric}}",
          "range": true,
          "refId": "A"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "editorMode": "code",
          "expr": "dlc_system_sensor{server=\"dg5R\", component=\"environment\", metric=\"air_humidity\"}",
          "legendFormat": "{{metric}}",
          "range": true,
          "refId": "B"
        }
      ],
      "title": "Chassis Temperature & Humidity",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": 0
              },
              {
                "color": "#EAB839",
                "value": 10
              },
              {
                "color": "green",
                "value": 20
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 12,
        "x": 12,
        "y": 43
      },
      "id": 14,
      "options": {
        "legend": {
          "calcs": [
            "min",
            "max",
            "mean"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.1.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "editorMode": "code",
          "expr": "dlc_system_sensor{server=\"dg5R\", component=\"memory\", metric=\"available\"} / ignoring(metric, unit) dlc_system_sensor{server=\"dg5R\", component=\"memory\", metric=\"total\"} * 100",
          "legendFormat": "Available %",
          "range": true,
          "refId": "A"
        }
      ],
      "title": "Memory Available %",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "dashed"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "#EAB839",
                "value": 75
              },
              {
                "color": "red",
                "value": 90
              }
            ]
          },
          "unit": "celsius"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 17,
        "w": 12,
        "x": 0,
        "y": 49
      },
      "id": 11,
      "options": {
        "legend": {
          "calcs": [
            "min",
            "max",
            "mean"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.1.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "editorMode": "code",
          "expr": "dlc_system_sensor{server=\"dg5R\", component=~\"gpu.\", metric=\"temperature\"}",
          "legendFormat": "{{component}}",
          "range": true,
          "refId": "A"
        }
      ],
      "title": "AI Processor Temperature",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "dashed"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "#EAB839",
                "value": 600
              },
              {
                "color": "red",
                "value": 700
              }
            ]
          },
          "unit": "watt"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 17,
        "w": 12,
        "x": 12,
        "y": 49
      },
      "id": 12,
      "options": {
        "legend": {
          "calcs": [
            "min",
            "max",
            "mean"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.1.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "editorMode": "code",
          "expr": "dlc_system_sensor{server=\"dg5R\", component=~\"gpu.\", metric=\"power_current\"}",
          "legendFormat": "{{component}}",
          "range": true,
          "refId": "A"
        }
      ],
      "title": "AI Processor Power Usage",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "dashed"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "#EAB839",
                "value": 85
              },
              {
                "color": "red",
                "value": 95
              }
            ]
          },
          "unit": "celsius"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 7,
        "w": 12,
        "x": 0,
        "y": 66
      },
      "id": 17,
      "options": {
        "legend": {
          "calcs": [
            "min",
            "max",
            "mean"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.1.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "editorMode": "code",
          "expr": "dlc_system_sensor{server=\"dg5R\", component=~\"cpu[0-9]\", metric=\"temperature\"}",
          "legendFormat": "{{component}}",
          "range": true,
          "refId": "A"
        }
      ],
      "title": "CPU Temperature",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${datasource}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "dashed"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "#EAB839",
                "value": 250
              },
              {
                "color": "red",
                "value": 300
              }
            ]
          },
          "unit": "watt"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 7,
        "w": 12,
        "x": 12,
        "y": 66
      },
      "id": 18,
      "options": {
        "legend": {
          "calcs": [
            "min",
            "max",
            "mean"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "12.1.0",
      "targets": [
        {
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "editorMode": "code",
          "expr": "dlc_system_sensor{server=\"dg5R\", component=~\"cpu[0-9]\", metric=\"power\"}",
          "legendFormat": "{{component}}",
          "range": true,
          "refId": "A"
        }
      ],
      "title": "CPU Power Usage",
      "type": "timeseries"
    }
  ],
  "preload": false,
  "refresh": "10s",
  "schemaVersion": 41,
  "tags": [
    "dg5R",
    "DLC"
  ],
  "templating": {
    "list": [
      {
        "current": {
          "text": "prometheus",
          "value": "fet9pt33egpogb"
        },
        "hide": 2,
        "includeAll": false,
        "label": "datasource",
        "name": "datasource",
        "options": [],
        "query": "prometheus",
        "refresh": 1,
        "regex": "",
        "type": "datasource"
      }
    ]
  },
  "time": {
    "from": "now-5m",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "dg5R Dashboard",
  "uid": "dg5R-dashboard-v1",
  "version": 9
}
